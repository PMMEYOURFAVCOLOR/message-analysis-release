Hi, I'm PM_ME_YOUR_FAV_COLOR. You may remember me from that crappy pie 
chart of 100 or so favorite colors I posted a year ago. After my inbox 
blew up with thousands of new PM's, I figured I owed you all an update. 
Here's a much cleaner chart of Reddit's favorite colors. [OC]

https://i.imgur.com/Mi4GcxL.jpg

# Links

[Full album](https://imgur.com/a/pyHTn)

[Message Data](https://raw.GitHubusercontent.com/PMMEYOURFAVCOLOR/message-analysis-release/master/report_gdocs_20171004T193628.csv)

[Color Tally](https://GitHub.com/PMMEYOURFAVCOLOR/message-analysis-release/blob/master/report_count_20171004T193628.csv)

[GitHub repo](https://GitHub.com/PMMEYOURFAVCOLOR/message-analysis-release)

# Introduction

If you have no idea what I'm talking about in the title, see [my original 
post here](https://www.reddit.com/r/dataisbeautiful/comments/5cz8fa/sometimes_i_forget_my_own_username_and_get_really/). The response to that was crazy. I got more PM's in one 
day than I had in the three years prior. I knew I needed to make an 
update, but was overwhelmed at the nearly seven thousand messages I had 
to sort through. Now, after 10 months, thousands of PM's, and hundreds of 
lines of code I'm finally done.

# Code used

While hand counting the messages from my first post was easy enough, 
manually tallying seven thousand PM's with any sort of consistency is a 
bit more difficult, not to mention time consuming and boring. Instead, I 
opted to write a Python script to do the counting and analysis for me. 
Although I probably spent more time learning how to code in Python 
and work with SQLite than it would have taken to do by hand, I wouldn't 
have learned nearly as much if I just did it manually.

There are two main pieces of code at work here. First is the message 
archive bot, [messagearchive.py](https://github.com/PMMEYOURFAVCOLOR/message-analysis-release/blob/master/messagearchive%20-scrubbed.py). This logs into my account and downloads 
all of my messages to a SQLite database. While it supports exporting that 
data to a text file, I soon found out that importing six thousand rows 
into LibreOffice Calc, and then performing a thousand regular expression 
searches on each row started to reach the limits of spreadsheet software.

Second is my database analyzer, [dbazr.py](https://github.com/PMMEYOURFAVCOLOR/message-analysis-release/blob/master/dbazr.py). This takes the message database 
generated by the previous script, performs a search of each defined color 
in XKCD's [rgb.csv](https://xkcd.com/color/rgb/) across each message entry, does 
some other helpful analysis functions, and generates charts of the data 
using matplotlib. While the previous program was written by /u/GoldenSights ([GitHub](https://GitHub.com/voussoir/reddit/blob/master/_old/MessageArchive/messagearchive.py)) and 
only slightly modified by me to get working, dbazr.py was written 
entirely from scratch.

# How does the script figure out my color?

The meat of this script is a very simple regular expression performed 
(literally) millions of times. If you're unfamiliar with the term regular 
expression (or regex), think of it as a more complicated and powerful 
CTRL+F. [This site taught me pretty much everything I needed to know about 
regex when I initially tried to analyze this data in notepad++ and 
LibreOffice](http://www.regular-expressions.info/). The script searches 
for a word boundary, then a color, then another word boundary. That way 
messages like "!red!", "Red.", and "I choose red" are matched, while "I 
dont have a color I'm just bored" don't pick up on the 'red' in 'bored'.

If you're curious about what your message was counted as, [see this file on 
GitHub](https://raw.GitHubusercontent.com/PMMEYOURFAVCOLOR/message-analysis-release/master/report_gdocs_20171004T193628.csv). For privacy reasons, you won't be able to find your 
plaintext username in there, only a hash of it. To figure out which entry 
is yours you need to take an SHA256 hash of 
"usernamehash+/u/Your_Username_Here" (without the quotes), then find that 
in the table. To do this you can either:

1. Download and run [hash-name-with-salt.py](https://github.com/PMMEYOURFAVCOLOR/message-analysis-release/blob/master/hash-name-with-salt.py) from my GitHub repo. After generating your hash, open the username data file and search for your hash.

1. Generate your own hash, either with a hash tool you already have or by
using a web-based SHA-256 tool. [This site](http://www.xorbin.com/tools/sha256-hash-calculator)
seems to work well, but use it at your own risk.

Keep in mind this table only represents messages sent to me before I made 
this post. If you've never sent me a PM before and try to send one now 
you will not automatically see yourself on this table.

# Plotting the data

After all the messages are tagged and organized, the data is sent to a 
matplotlib function. Each color is drawn on a 2D grid, x location being 
hue and y location being either saturation or value. If the chart is set 
up with saturation on the Y, then any similar color with the same hue and 
saturation but different value will be plotted over top of one another. 
Each color bubble is sized according to the number of messages found 
containing that color by overall area, not radius. As long as the transparency is set to 1, the 
color of the bubble should match the hex code defined in rgb.csv. 
However, most variants of the plot have some degree of transparency and 
so using a color picker on those charts will make the drawn color appear 
lighter than what it represents.

I included as many different plots of the data as I could in the [imgur 
album](https://imgur.com/a/pyHTn), but if you'd like for me to change some of the parameters and 
re-render the plot let me know (preferably through a comment reply, PM's 
tend to get lost in the sea of favorite colors). Take a look at the code 
on [GitHub](https://github.com/PMMEYOURFAVCOLOR/message-analysis-release) and see if what you're looking for can be easily 
changed in one of my internal parameters for renderHSVchart() within 
dbazr.py, otherwise I'll see what I can do.

# Additional notes

Even though I used a script to analyze my messages, I still went through 
and read many of them. [My personal favorite was from /u/AsbestosCompany](https://i.imgur.com/rmlDh80.png).
Additionally, I can proudly say that I got [a favorite color from the legendary
 /u/PM_ME_YOUR_TITS_GIRL](https://i.imgur.com/VRhcrDJ.png), whose idea I shamelessly stole when I made this account. (Permission was granted before reposting all PM's.)

# Further explanation of how I figured all this out

Originally I started this analysis a month or so after my post by 
looking into downloading gmail messages, since I realized that all of my 
PM's were already being emailed to me and dumped straight into a junk 
folder I forgot I made. That was a bit too tricky, so next I found a bot 
/u/Goldensights already made to download messages. After a bit of 
setup, that method worked perfectly. I exported my messages to a text file 
and parsed them in notepad++, learning the ins and outs of regular 
expressions along the way. I then imported all of that data into 
LibreOffice. I tried way too hard to get LibreOffice to work. After so many 
unsuccessful attempts I gave up on the spreadsheet method and tried to 
approach this from a different angle.

I kept procrastinating figuring out how to actually analyze all this 
data, but 6 months later I finally got back to it. I decided I'd write a 
program instead of messing with spreadsheets. The most complicated 
programming I ever did before this were just small batch files, bash 
scripts, and custom excel formulas. The original downloader bot used 
Python to access a SQLite database so I figured I'd start there. I 
researched the basics of using SQLite and Python. I Googled (or really 
Duckduckgo'd) everything I learned. I relied heavily on StackOverflow, 
much as any other developer would I imagine. SQLitetutorial.net was the 
best resource I used to figure out how to work with that database, and 
the Python docs helped me with the more complicated parts of the code.

I also learned how to use git to track my changes, which was much nicer 
than making a million different copies of different versions of the code. 
I started out by writing comments explaining what I wanted my code to do, 
researching how to actually do that in Python/SQLite, then filling in 
that particular bit under the comment. I wrote the script a little bit 
each day, and gave myself time between coding sessions to think about 
what sort of logic I'd need to implement.

As some suggested, I used XKCD's color survey results along with Randall's 
rgb.txt. That file lists almost a thousand colors named and defined by hex value. 

If anyone has any further questions about my code I'll be happy to answer 
them as best I can. I'm not a programmer by any means, but I did pick up 
on a good amount while learning how to write Python code.

Also, if anyone has any suggestions relating to my code, or how I could 
have done this better, or any cool Python modules that work make doing 
this again easier, or anything else of that nature -- PLEASE tell me in a 
comment below as I'm much more likely to see it there. If you have to PM 
me, make sure you wait at least a week, preferably a solid month, before 
sending it. Otherwise it'll likely get lost in the sea of new PM's, just 
as many other people's suggestions did the last go around (as I only 
recently found out while sorting through some of my messages manually).

# Limitations

While this code is helpful in quickly tagging messages with favorite 
colors and tallying them, it does have some limitations. Firstly, and I 
think this applies to the most number of people, the script finds 
anything and everything it can in your message. If you say "I hate blue, 
red is so much better" then the script just put you down for a vote for 
blue and a vote for and red. In my original post I said I treated any 
message that listed multiple colors as multiple votes, with the 
assumption that people that are so torn between multiple colors deserve a 
vote for each. After manually going through this new batch of data I 
found a lot of the messages I received in which the script found multiple 
colors did in fact follow this same pattern--the person explained a few 
of their top colors and why they liked each. In order to account for 
those people I gave each message the benefit of the doubt and counted 
everything. The alternative would be to come up with some sort of 
prioritization logic, but that could skew the data (e.g. search for "red" 
first, then search for "blue" only if red wasn't already found).

What this also means is that if you say "Light green" then the script 
puts you down once for "light green" and again for "green", since both 
"light green" and "green" are separate entries in rgb.csv. I may look 
into arranging the search colors into parent colors and child colors so 
that I can generate a separate plot where "green" only represents people 
who said exactly "green" and not "dark green", "light green", and every 
other "green" modifier. However, I feel like the current behavior is 
permissible considering that same person who messaged me with "light 
green" most likely would have voted for green if their options were 
limited. This is also useful for comparisons between two or more main 
colors. If you want to compare the number of people who voted 'red' vs 
the number of people that voted 'blue', I feel like it's fair to lump in 
the lights, darks, neons, pastels, fadeds, etc. into their respective 
parent colors.

If you messaged me the same color multiple times in the same PM (e.g. 
"red red red red"), your message was still only counted as one vote for 
that particular color since the code only searches for the existence of 
that color, not how many there are. If you sent me multiple PM's in the 
same tree (e.g. you replied to your first PM to add on some colors you 
forgot) then my script didn't see them since messagearchive.py only grabs 
the first message in the conversation. However, if you sent me multiple 
PM's, and initiated a new conversation (with a new subject and all), then 
every message you sent counts as its own vote. I know for a fact after 
reading this people are going to abuse this, so know that I'll fix this 
in the future. If I make another one, my next update will likely only 
grab the most recent message you've sent me if you've sent multiple, both 
to allow for people to change their favorite color and to prevent one 
person from spamming the same color over and over.

This script primarily searches for the regular colors (e.g. 'red', 
'blue', 'green') that can be found in rgb.csv. However, many people sent 
colors that couldn't be found in that list. The most common form of these 
'nonstandard' colors were hex color codes. These are definitely trickier 
to search for, since you can't just generate a table of every possible 
hex code combination (over 16 million!) and search against that. However, 
using some more regex, I was able to capture most of those codes. If you 
sent a hex code beginning with a '#', then the script easily found it. If 
you sent a hex code without a preceding '#' then the script likely found 
it, but yours may be a bit harder to find. With all this said, hex codes 
are only searched for in messages that don't already have a tag. So if 
you listed both a general color and a specific hex code in the same 
message then the script only captured the name of the color you sent. 
This helps prevent messages from wrongly being treated as hex codes, as 
any 6 letter word containing only the first six letters of the alphabet 
can also be considered a hex color.